var droneaid=function(e){"use strict";const r=function(e){return tf.tidy(()=>{const r=tf.browser.fromPixels(e),t=function(e,r){let t=400/Math.max(e,r);return{width:Math.round(t*e),height:Math.round(t*r)}}(r.shape[0],r.shape[1]);return r.resizeBilinear([t.width,t.height]).expandDims()})},t=function(e){return function(e){return new Promise((r,t)=>{if("string"==typeof e){const o=new Image;o.onload=(()=>r(o)),o.onerror=(e=>t(e)),o.src=e}else r(e)})}(e).then(r).then(e=>Promise.resolve(e)).catch(e=>(console.error(e),Promise.reject(e)))};let o=null,n=!1;const s=function(e){return o?c(e)&&!n?(a(),Promise.resolve(o)):Promise.resolve(o):tf.loadGraphModel("/model_web/model.json").then(r=>(o=r,c(e)&&a(),Promise.resolve(o))).catch(e=>(console.error(e),Promise.reject(e)))},i=async function(e){if(e){if(o){const r=await o.executeAsync({image_tensor:e});return n=!0,r}throw console.error("model not available"),new Error("model not available")}throw console.error("no image provided"),new Error("no image provided")},a=function(){try{i(tf.ones([1,1024,1024,3]))}catch(e){}},c=function(e){return null===e||void 0===e||"string"==typeof e&&"true"===e.toLowerCase()||"boolean"==typeof e&&e};{const e=document.currentScript.getAttribute("data-init-model");c(e)&&s(!0).then(()=>{console.log("model initialized")})}const l=["children","ok","water","firstaid","sos","shelter","elderly","food"],u=function(e,r){return new Promise(async(t,o)=>{let n=.3,s=.5,i=10;r&&(n=r.scoreThreshold||.3,s=r.iouThreshold||.5,i=r.maxNumBoxes||10);const a=await e[0].data(),c=e[1].unstack()[0];tf.dispose(e);const[u,d]=((e,r,t)=>{const o=[],n=[];for(let s=0;s<r;s++){let r=Number.MIN_VALUE,i=-1;for(let o=0;o<t;o++)e[s*t+o]>r&&(r=e[s*t+o],i=o);o[s]=r,n[s]=i}return[o,n]})(a,e[0].shape[1],e[0].shape[2]),h=c.reshape([c.shape[0],c.shape[2]]),f=await c.array();c.dispose();const m=await tf.image.nonMaxSuppressionAsync(h,u,i,s,n),p=await m.data();h.dispose(),m.dispose(),t(((e,r,t,o)=>{const n=[];for(let s=0;s<e.length;s++){const i=e[s],a=r[i][0];n.push({class:t[i],score:o[i],bbox:a.map(e=>Math.max(0,+e.toFixed(4))),label:l[t[i]]})}return n})(p,f,d,u))})},d=function(e,r){return r&&r.mirrorImage,t(e)},h=function(e){return r=e,s(!1).then(()=>{try{return i(r)}catch(e){return Promise.reject(e)}});var r},f=function(e,r){return u(e,r)};return e.labels=l,e.loadModel=function(e){return s(e)},e.predict=function(e,r){return d(e,r).then(h).then(e=>f(e,r)).catch(e=>{console.error(e)})},e.processInput=d,e.processOutput=f,e.runInference=h,e.version="0.0.1",Object.defineProperty(e,"__esModule",{value:!0}),e}({});